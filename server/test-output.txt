go build -o tmp/sprite-env .
TSCRIPTS_DIR=$(cd test-scripts && pwd) go test -v -failfast ./tests
=== RUN   TestIntegration
    runner.go:51: Found test directories: [/Users/kurt/code/fly/sprite-env/server/test-scripts/_shared /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1 /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-2]
=== RUN   TestIntegration/basic-1
    runner.go:67: Running test for directory: /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1
    runner.go:95: Running command: [/Users/kurt/code/fly/sprite-env/server/tmp/sprite-env -tla-trace -debug -test-dir /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1 -- /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh]
    runner.go:111: Started process with PID: 6380
    runner.go:208: Waiting for completion signal...
DEBUG: Using test scripts from /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1
DEBUG: Using supervised process: /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh
DEBUG: Starting component DB with command: /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/db/start.sh
DEBUG: Component DB process started with PID 6381
DEBUG: Starting component FS with command: /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/fs/start.sh
DEBUG: Component DB running ready command: /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/db/ready.sh
DEBUG: Component FS process started with PID 6382
DEBUG: ComponentSet started, supervised process will start when components are ready
DEBUG: Component FS running ready command: /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/fs/ready.sh
db: starting litestream replication...
fs: starting juicefs mount...
fs: connecting to metadata service...
db: litestream replication started
db: replication status: active
db: replication lag: 0s
db: replication health: healthy
fs: metadata service connected
fs: mounting filesystem...
DEBUG: Component DB ready command succeeded
DEBUG: DB state changed from Initializing to Running
DEBUG: DB signaling readiness due to Running state
DEBUG: DB sent state change Running on channel
DEBUG: ComponentSet received state change for component DB: Running
DEBUG: ComponentSet overall state is now: Running
DEBUG: ComponentSet sent overall state change: Running
DEBUG: Received state change: Running
DEBUG: Checking supervised process state: Stopped
DEBUG: All components ready, starting supervised process
2025/06/07 15:05:43 DEBUG: Process [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh []]: Starting supervised process: /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh []
DEBUG: Process state changing to Starting
DEBUG: Process state changed from Stopped to Starting
2025/06/07 15:05:43 DEBUG: Process [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh ]]: Process command: /Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh []
2025/06/07 15:05:43 DEBUG: Process [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh ]]: Setting up output forwarding for process
DEBUG: Process state changed from Stopped to Starting
2025/06/07 15:05:43 DEBUG: Process [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh ]]: Process started successfully, PID: 6422
DEBUG: Process state changing to Running
DEBUG: Process state changed from Starting to Running
DEBUG: Process state changed from Starting to Running
supervised process started
fs: filesystem mounted successfully
fs: mount point: /mnt/juicefs
fs: metadata: sqlite3:///var/lib/juicefs/meta.db
fs: storage: s3://my-bucket/juicefs
DEBUG: Component FS ready command succeeded
DEBUG: FS state changed from Initializing to Running
DEBUG: FS signaling readiness due to Running state
DEBUG: FS sent state change Running on channel
DEBUG: ComponentSet received state change for component FS: Running
DEBUG: ComponentSet overall state is now: Running
DEBUG: ComponentSet sent overall state change: Running
DEBUG: Received state change: Running
DEBUG: Checking supervised process state: Running
    runner.go:212: Sending SIGTERM to process
    runner.go:218: Waiting for process to exit
DEBUG: Received signal: interrupt
DEBUG: Signal handler received: interrupt
DEBUG: Stopping supervised process
2025/06/07 15:05:45 DEBUG: Process [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh ]]: Stopping supervised process
DEBUG: Process state changing to Stopping
DEBUG: Process state changed from Running to Stopping
supervised-process.sh: received signal SIGTERM
DEBUG: Process state changed from Running to Stopping
2025/06/07 15:05:45 DEBUG: Process [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh ]]: Supervised process exited successfully
DEBUG: Process state changing to Exited
DEBUG: Process state changed from Stopping to Exited
2025/06/07 15:05:45 DEBUG: Process [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh [/Users/kurt/code/fly/sprite-env/server/test-scripts/basic-1/supervised-process.sh ]]: Process stopped successfully
DEBUG: Supervised process stopped, now stopping components
DEBUG: Process state changed from Stopping to Exited
make: *** [test] Hangup: 1
