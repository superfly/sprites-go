# Sprite tmux configuration
# This config disables all tmux commands except detach (Ctrl-b, d) and allows focus and mouse scrolling

# Disable mouse support to allow terminal's native text selection
set -g mouse off

# Use vi-style key bindings in copy mode
set -g mode-keys vi

# Set terminal overrides for better mouse support
set -ga terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q'

# Disable all key bindings by unbinding everything
unbind-key -a

# Set the prefix key to Ctrl-b
set -g prefix C-b

# Only allow detach
bind-key d detach-client

# Override default copy binding to use OSC 52 clipboard (if copy mode is entered manually)
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "tmux show-buffer | tmux run 'printf \"\033]52;c;$(base64 | tr -d \"\n\")\a\"'"

# Disable scroll wheel from entering copy mode
unbind-key -T root WheelUpPane
unbind-key -T root WheelDownPane

# Send mouse drag events back to terminal by temporarily disabling mouse mode
# This allows terminal selection while keeping click-to-focus
bind-key -T root MouseDrag1Pane if -F '#{mouse_any_flag}' 'send-keys -M' 'set -g mouse off'


# Disable status bar
set -g status off

# Enable focus events
set -g focus-events on

# Terminal settings for better compatibility
set -g default-terminal "screen-256color"
set -ga terminal-overrides ',xterm-256color:Tc'

# Window and pane settings
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

# Disable bells
set -g bell-action none
set -g visual-bell off

# Disable escape time delay
set -sg escape-time 0

# Keep windows and panes alive when the program exits
set -g remain-on-exit off

# Disable automatic renaming
set -g automatic-rename off
set -g allow-rename off

# Set title
set -g set-titles on
set -g set-titles-string "Sprite Exec Session #S"

# Update environment variables from client
# This list includes common variables that should be inherited
set -g update-environment "DISPLAY SSH_AUTH_SOCK SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY"

# Add specifically requested environment variables
set -ga update-environment " ASDF_DATA_DIR ASDF_DEFAULT_TOOL_VERSIONS_FILENAME ASDF_DIR"
set -ga update-environment " BROWSER COLORTERM DEBIAN_FRONTEND FLYCTL_INSTALL"
set -ga update-environment " HOME LANG LESSCLOSE LESSOPEN LS_COLORS"
set -ga update-environment " PATH PWD SHLVL TERM _"

# Add common development environment variables
set -ga update-environment " LD_LIBRARY_PATH MANPATH"

# Add common user environment variables
set -ga update-environment " USER LOGNAME SHELL LC_*"

# Add common container/sprite environment variables
set -ga update-environment " HOSTNAME OLDPWD EDITOR VISUAL PAGER"

# Add Node.js/npm environment variables
set -ga update-environment " NODE_ENV NPM_CONFIG_* NVM_* NODE_*"

# Add Python environment variables
set -ga update-environment " PYTHONPATH VIRTUAL_ENV PIPENV_* POETRY_*"

# Add Ruby environment variables
set -ga update-environment " GEM_HOME GEM_PATH RUBY_* BUNDLE_*"

# Add Go environment variables
set -ga update-environment " GOPATH GOROOT GO111MODULE GOPROXY"

# Add other development tools
set -ga update-environment " JAVA_HOME MAVEN_* GRADLE_* CARGO_* RUSTUP_*"
