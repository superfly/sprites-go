=======================================================
Sprite Environment Documentation
=======================================================

This document describes features provided by the Sprite server across environments.

CHECKPOINTS AND RESTORES (SOCKET API)
=====================================

Create, list, and restore checkpoints via the local socket API at `/.sprite/api.sock`.
Use the `curl-sprite-api` helper for convenience (it talks to the socket with auth):

  curl-sprite-api -X POST /checkpoint                    # Create checkpoint (NDJSON stream)
  curl-sprite-api -X GET  /checkpoints                   # List checkpoints (JSON)
  curl-sprite-api -X GET  /checkpoints/<id>              # Get checkpoint details (JSON)
  curl-sprite-api -X POST /checkpoints/<id>/restore      # Restore (NDJSON stream)

Notes
-----
- All requests require a valid token; the helper injects it automatically.
- Endpoints stream progress as NDJSON for create/restore operations.
- Restores affect the entire sprite state.

SPRITE API SOCKET
=================

A local API socket is mounted inside the sprite at:

  /.sprite/api.sock

This Unix domain socket is used by Sprite tooling for authenticated, local API calls to the sprite server.


SPRITE URLS AND PUBLIC ACCESS
=============================

If your sprite has a public URL (e.g., <name>-<rand>.sprites.app), it forwards HTTP traffic to a service inside your sprite. To use URL-based access:

1) Run a web service on port 8080
   - For quick tests: start your app manually and bind to 0.0.0.0:8080
   - Example:
     - Node: npm start (ensure it listens on 0.0.0.0:8080)
     - Python: python -m http.server 8080 --bind 0.0.0.0

2) Register a service so it restarts automatically
   - Register a long-running process so it starts on boot and restarts on failure.
   - Minimal contract: give it a name, command, and args; it should listen on port 8080.

Authenticated access
--------------------
By default, sprite URLs require an Authorization header with your sprite org token.

  Authorization: Bearer <token>

This is especially useful for programmatic access (curl, fetch, etc.).

Managing the public URL externally
----------------------------------
From your local machine (outside the sprite), you can manage the public URL settings:

  - Show URL for the current sprite:
    sprite url

  - Make the URL publicly accessible (no auth required):
    sprite url update --auth public

  - Require authentication (default behavior):
    sprite url update --auth default

Notes
-----
- The URL points to port 8080 in your sprite. Ensure a process is listening there.
- Registering the service ensures it comes back if the sprite restarts.